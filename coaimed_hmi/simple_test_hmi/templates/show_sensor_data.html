{% extends "base.html" %}

{% block content %}
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {font-family: Arial;}

/* Style the tab */
.tab {
  overflow: hidden;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
}

/* Style the buttons inside the tab */
.tab button {
  background-color: inherit;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 14px 16px;
  transition: 0.3s;
  font-size: 20px;
}

/* Change background color of buttons on hover */
.tab button:hover {
  background-color: #ddd;
}

/* Create an active/current tablink class */
.tab button.active {
  background-color: #ccc;
}

/* Style the tab content */
.tabcontent {
  display: none;
  padding: 6px 12px;
  border: 1px solid #ccc;
  border-top: none;
}

.topright {
  position: absolute;
  top: 8px;
  right: 16px;
  font-size: 18px;
}
</style>

<img class="logo" src="static/images/odin-logo.png">

<div class="column is-4 is-offset-4">
    <div class="box">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="notification is-danger">
                {{ messages[0] }}
            </div>
        {% endif %}
        {% endwith %}
        
        <a href="{{ url_for('profile') }}" class="button is-block is-info is-large is-fullwidth">Back</a>
    </div>
</div>

<form method="POST" action="/send_rehabilitation_task">
    <div class="field">
        <div class="control">
            <input class="input is-large" type="text" name="task_type" placeholder="Insert here the rehab task">
        </div>
    </div>

    <div class="field">
        <div class="control">
            <input class="input is-large" type="text" name="num_rep" placeholder="Insert here the number of repetitions">
        </div>
    </div>

    <div class="field">
        <div class="control">
            <input class="input is-large" type="text" name="angle_th" placeholder="Insert here the angle threshold">
        </div>
    </div>
    
    <div class="control">
        <button class="button is-block is-info is-large is-fullwidth">SEND TASK</button>
    </div>   
</form>

<div class="tab">
    <button class="tablinks" onclick="openTab(event, 'SensorsStatus')">Sensors Status</button>
    <button class="tablinks" onclick="openTab(event, 'SensorsActivities')">Sensors Activities</button>
</div>

<div id="SensorsStatus" class="tabcontent">
    <h3>Sensors Status</h3>
    <ul id="sensors-status-list">
        <!-- Sensor status data will be populated here -->
    </ul>
</div>

<div id="SensorsActivities" class="tabcontent">
    <h3>Sensors Activities</h3>
    <ul id="sensors-activities-list">
        <!-- Sensor activities data will be populated here -->
    </ul>
</div>

<script>
function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
}

// Fetch sensors status data from Flask endpoint
function fetchSensorsStatusData() {
    $.get('/sensors_status_data', function(result) {
        var list = $("#sensors-status-list");
        list.empty();
        result.forEach(function(item) {
            list.append('<li>' + JSON.stringify(item) + '</li>');
        });
    });
}

// Fetch sensors activities data from Flask endpoint
function fetchSensorsActivitiesData() {
    $.get('/sensors_activities_data', function(result) {
        var list = $("#sensors-activities-list");
        list.empty();
        result.forEach(function(item) {
            list.append('<li>' + JSON.stringify(item) + '</li>');
        });
    });
}

// Set interval to fetch data every 5 seconds
setInterval(fetchSensorsStatusData, 5000);
setInterval(fetchSensorsActivitiesData, 5000);
</script>

{% endblock %}

